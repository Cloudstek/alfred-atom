'use strict';var _regenerator=require('babel-runtime/regenerator');var _regenerator2=_interopRequireDefault(_regenerator);var _asyncToGenerator2=require('babel-runtime/helpers/asyncToGenerator');var _asyncToGenerator3=_interopRequireDefault(_asyncToGenerator2);var _getIterator2=require('babel-runtime/core-js/get-iterator');var _getIterator3=_interopRequireDefault(_getIterator2);var _keys=require('babel-runtime/core-js/object/keys');var _keys2=_interopRequireDefault(_keys);var _classCallCheck2=require('babel-runtime/helpers/classCallCheck');var _classCallCheck3=_interopRequireDefault(_classCallCheck2);var _createClass2=require('babel-runtime/helpers/createClass');var _createClass3=_interopRequireDefault(_createClass2);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj};}var color=require('color');var fs=require('fs');var Hugo=require('alfred-hugo');var path=require('path');var octicons=require('octicons');var octiconsPath=path.join(path.dirname(require.resolve('octicons')),'build','svg');var svgexport=null;try{svgexport=require('svgexport')||null;}catch(err){}var Icons=function(){function Icons(){(0,_classCallCheck3.default)(this,Icons);}(0,_createClass3.default)(Icons,[{key:'_pathColor',value:function _pathColor(){var iconColor=color('#FFFFFF');if(Hugo.alfredThemeFile){try{iconColor=color(Hugo.alfredTheme.result.text.color);}catch(e){}}else if(process.env.alfred_theme_background){var bgColor=color(process.env.alfred_theme_background);iconColor=bgColor.grayscale().negate();}return iconColor.rgb().string();}},{key:'usedIcons',value:function usedIcons(projects){var icons=[];var octiconNames=(0,_keys2.default)(octicons);var iconPath=path.join(__dirname,'icons');var _iteratorNormalCompletion=true;var _didIteratorError=false;var _iteratorError=undefined;try{for(var _iterator=(0,_getIterator3.default)(projects),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var project=_step.value;if(!project.hasOwnProperty('icon')){continue;}var icon=path.parse(project.icon.path);if(icon.dir===iconPath&&octiconNames.indexOf(icon.name)>=0){if(icons.indexOf(icon.name)===-1){icons.push(icon.name);}}}}catch(err){_didIteratorError=true;_iteratorError=err;}finally{try{if(!_iteratorNormalCompletion&&_iterator.return){_iterator.return();}}finally{if(_didIteratorError){throw _iteratorError;}}}return icons;}},{key:'checkDependencies',value:function checkDependencies(){try{require.resolve('svgexport');}catch(err){return false;}return true;}},{key:'rebuild',value:function(){var _ref=(0,_asyncToGenerator3.default)(_regenerator2.default.mark(function _callee(projects){var options=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};var iconPath,iconSize,renderQueue,icons,renderOptions,_iteratorNormalCompletion2,_didIteratorError2,_iteratorError2,_iterator2,_step2,icon;return _regenerator2.default.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:if(svgexport){_context.next=2;break;}return _context.abrupt('return',false);case 2:iconPath=path.join(__dirname,'icons');iconSize=64;renderQueue=[];icons=this.usedIcons(projects);if(options&&options.onlyMissing===true){icons=icons.filter(function(icon){try{fs.statSync(path.join(iconPath,icon+'.png'));return false;}catch(e){return true;}});}if(!(icons.length===0)){_context.next=9;break;}return _context.abrupt('return');case 9:if(Hugo.alfredTheme.result&&Hugo.alfredTheme.result.iconSize){iconSize=Hugo.alfredTheme.result.iconSize;}renderOptions=[iconSize+':'+iconSize,'pad','path{fill:'+this._pathColor()+'}'];_iteratorNormalCompletion2=true;_didIteratorError2=false;_iteratorError2=undefined;_context.prev=14;for(_iterator2=(0,_getIterator3.default)(icons);!(_iteratorNormalCompletion2=(_step2=_iterator2.next()).done);_iteratorNormalCompletion2=true){icon=_step2.value;if(icon&&icon.length>0){renderQueue.push({input:path.join(octiconsPath,icon+'.svg'),output:[[path.join(iconPath,icon+'.png')].concat(renderOptions)]});}}_context.next=22;break;case 18:_context.prev=18;_context.t0=_context['catch'](14);_didIteratorError2=true;_iteratorError2=_context.t0;case 22:_context.prev=22;_context.prev=23;if(!_iteratorNormalCompletion2&&_iterator2.return){_iterator2.return();}case 25:_context.prev=25;if(!_didIteratorError2){_context.next=28;break;}throw _iteratorError2;case 28:return _context.finish(25);case 29:return _context.finish(22);case 30:Hugo.notify({message:`Rebuilding ${renderQueue.length} project icons, please wait.`});svgexport.render(renderQueue,function(err){if(err){throw err;}});case 32:case'end':return _context.stop();}}},_callee,this,[[14,18,22,30],[23,,25,29]]);}));function rebuild(_x2){return _ref.apply(this,arguments);}return rebuild;}()}]);return Icons;}();module.exports=new Icons();
//# sourceMappingURL=icons.js.map
