"use strict";var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");var _regenerator=_interopRequireDefault(require("@babel/runtime/regenerator"));var _asyncToGenerator2=_interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator"));var _getIterator2=_interopRequireDefault(require("@babel/runtime/core-js/get-iterator"));var _keys=_interopRequireDefault(require("@babel/runtime/core-js/object/keys"));var _classCallCheck2=_interopRequireDefault(require("@babel/runtime/helpers/classCallCheck"));var _createClass2=_interopRequireDefault(require("@babel/runtime/helpers/createClass"));var color=require('color');var fs=require('fs');var Hugo=require('alfred-hugo');var path=require('path');var octicons=require('octicons');var octiconsPath=path.join(path.dirname(require.resolve('octicons')),'build','svg');var svgexport=null;try{svgexport=require('svgexport')||null;}catch(err){}var Icons=function(){function Icons(){(0,_classCallCheck2.default)(this,Icons);}(0,_createClass2.default)(Icons,[{key:"_pathColor",value:function _pathColor(){var iconColor=color('#FFFFFF');if(Hugo.alfredMeta.themeFile){try{iconColor=color(Hugo.alfredTheme.result.text.color);}catch(e){}}else if(process.env.alfred_theme_background){var bgColor=color(process.env.alfred_theme_background);iconColor=bgColor.grayscale().negate();}return iconColor.rgb().string();}},{key:"usedIcons",value:function usedIcons(projects){var icons=[];var octiconNames=(0,_keys.default)(octicons);var iconPath=path.join(__dirname,'icons');var _iteratorNormalCompletion=true;var _didIteratorError=false;var _iteratorError=undefined;try{for(var _iterator=(0,_getIterator2.default)(projects),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var project=_step.value;if(!project.hasOwnProperty('icon')){continue;}var icon=path.parse(project.icon.path);if(icon.dir===iconPath&&octiconNames.indexOf(icon.name)>=0){if(icons.indexOf(icon.name)===-1){icons.push(icon.name);}}}}catch(err){_didIteratorError=true;_iteratorError=err;}finally{try{if(!_iteratorNormalCompletion&&_iterator.return!=null){_iterator.return();}}finally{if(_didIteratorError){throw _iteratorError;}}}return icons;}},{key:"checkDependencies",value:function checkDependencies(){try{require.resolve('svgexport');}catch(err){return false;}return true;}},{key:"rebuild",value:function(){var _rebuild=(0,_asyncToGenerator2.default)(_regenerator.default.mark(function _callee(projects){var options,iconPath,iconSize,renderQueue,icons,renderOptions,_iteratorNormalCompletion2,_didIteratorError2,_iteratorError2,_iterator2,_step2,icon,_args=arguments;return _regenerator.default.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:options=_args.length>1&&_args[1]!==undefined?_args[1]:{};if(svgexport){_context.next=3;break;}return _context.abrupt("return",false);case 3:iconPath=path.join(__dirname,'icons');iconSize=64;renderQueue=[];icons=this.usedIcons(projects);if(options&&options.onlyMissing===true){icons=icons.filter(function(icon){try{fs.statSync(path.join(iconPath,icon+'.png'));return false;}catch(e){return true;}});}if(!(icons.length===0)){_context.next=10;break;}return _context.abrupt("return");case 10:if(Hugo.alfredTheme.result&&Hugo.alfredTheme.result.iconSize){iconSize=Hugo.alfredTheme.result.iconSize;}renderOptions=[iconSize+':'+iconSize,'pad','path{fill:'+this._pathColor()+'}'];_iteratorNormalCompletion2=true;_didIteratorError2=false;_iteratorError2=undefined;_context.prev=15;for(_iterator2=(0,_getIterator2.default)(icons);!(_iteratorNormalCompletion2=(_step2=_iterator2.next()).done);_iteratorNormalCompletion2=true){icon=_step2.value;if(icon&&icon.length>0){renderQueue.push({input:path.join(octiconsPath,icon+'.svg'),output:[[path.join(iconPath,icon+'.png')].concat(renderOptions)]});}}_context.next=23;break;case 19:_context.prev=19;_context.t0=_context["catch"](15);_didIteratorError2=true;_iteratorError2=_context.t0;case 23:_context.prev=23;_context.prev=24;if(!_iteratorNormalCompletion2&&_iterator2.return!=null){_iterator2.return();}case 26:_context.prev=26;if(!_didIteratorError2){_context.next=29;break;}throw _iteratorError2;case 29:return _context.finish(26);case 30:return _context.finish(23);case 31:Hugo.notify({message:`Rebuilding ${renderQueue.length} project icons, please wait.`});svgexport.render(renderQueue,function(err){if(err){throw err;}});case 33:case"end":return _context.stop();}}},_callee,this,[[15,19,23,31],[24,,26,30]]);}));return function rebuild(_x){return _rebuild.apply(this,arguments);};}()}]);return Icons;}();module.exports=new Icons();
//# sourceMappingURL=icons.js.map
