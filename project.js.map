{"version":3,"sources":["project.js.flow"],"names":["fs","require","octicons","path","glob","changeCase","atomApp","process","env","terminalApp","Project","statSync","err","project","title","toLowerCase","replace","group","paths","join","iconPaths","icon","startsWith","octiconNames","indexOf","slice","__dirname","homedir","HOME","resolve","isAbsolute","i","length","push","_fileExists","app","args","command","concat","console","warn","item","uid","Buffer","from","_title","_subtitle","toString","subtitle","_icon","arg","_openArgument","valid","mods","alt","cmd","ctrl","fn","shift","projects","result","parse","undefined","projectHome","prettifyTitle","dirs","sync","cwd","forEach","dir","substring","parseAll","module","exports"],"mappings":"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","sourcesContent":["// @flow\n\nconst fs = require('fs');\nconst octicons = require('octicons');\nconst path = require('path');\nconst glob = require('glob');\nconst changeCase = require('change-case');\n\nconst atomApp = process.env.atomApp || 'Atom';\nconst terminalApp = process.env.terminalApp || 'Terminal';\n\nclass Project {\n    /**\n     * Check if file exists\n     *\n     * @param {string} path File path\n     *\n     * @return {boolean} True if file exists\n     */\n    _fileExists(path: string): boolean {\n        try {\n            fs.statSync(path);\n            return true;\n        } catch (err) {\n            return false;\n        }\n    }\n\n    /**\n     * Project UID\n     *\n     * @param {Object} project Atom project definition\n     *\n     * @return {string} Unique Alfred item ID used for caching\n     */\n    _uid(project: Object): string {\n        return project.title.toLowerCase().replace(' ', '_');\n    }\n\n    /**\n     * Project title\n     *\n     * @param {Object} project Atom project definition\n     *\n     * @return {string} Title\n     */\n    _title(project: Object): string {\n        let title:string = project.title;\n\n        if (project.group) {\n            title += ' - ' + project.group;\n        }\n\n        return title;\n    }\n\n    /**\n     * Project sub-title\n     *\n     * @param {Object} project Atom project definition\n     *\n     * @return {string} Sub-title\n     */\n    _subtitle(project: Object): string {\n        if (project.paths) {\n            return project.paths.join(', ');\n        }\n\n        return '';\n    }\n\n    /**\n     * Project icon\n     *\n     * @param {Object} project Atom project definition\n     *\n     * @return {string} Full path to icon\n     */\n    _icon(project: Object) {\n        let iconPaths = [];\n\n        if (project.icon) {\n            // Octicon\n            if (project.icon.startsWith('icon-')) {\n                let octiconNames = Object.keys(octicons);\n                if (octiconNames.indexOf(project.icon.slice(5)) >= 0) {\n                    return path.join(__dirname, 'icons', project.icon.slice(5) + '.png');\n                }\n            }\n\n            // Replace tilde\n            if (project.icon.startsWith('~/')) {\n                let homedir = process.env.HOME || '';\n                project.icon = path.resolve(homedir, project.icon.slice(2));\n            }\n\n            // Search for project icon if its path is relative\n            if (!path.isAbsolute(project.icon)) {\n                for (let i = 0; i < project.paths.length; i++) {\n                    iconPaths.push(path.resolve(project.paths[i], project.icon));\n                }\n            }\n\n            // Absolute path\n            if (this._fileExists(project.icon)) {\n                return project.icon;\n            }\n        }\n\n        // Search every project root dir for icon.png\n        for (let i = 0; i < project.paths.length; i++) {\n            iconPaths.push(path.join(project.paths[i], 'icon.png'));\n        }\n\n        // Find project icon\n        for (let i = 0; i < iconPaths.length; i++) {\n            if (this._fileExists(iconPaths[i])) {\n                return iconPaths[i];\n            }\n        }\n\n        return 'icon.png';\n    }\n\n    /**\n     * Open arguments\n     *\n     * @param {Object} project Atom project definition\n     * @param {string} app Application name\n     * @param {Array.string} args Application arguments\n     *\n     * @return {string} Open command\n     */\n    _openArgument(project: Object, app: string, args: Array<string> = []): string {\n        // Build shell command\n        let command = [\n            'open',\n            '-na',\n            `\"${app}\"`\n        ];\n\n        // Append project path(s)\n        if (project.paths) {\n            command.push('\"' + project.paths.join('\" \"') + '\"');\n        }\n\n        // Append arguments\n        if (args.length > 0) {\n            command.push('--args');\n            command = command.concat(args);\n        }\n\n        return command.join(' ');\n    }\n\n    /**\n     * Parse project\n     *\n     * @param {Object} project Atom project definition\n     *\n     * @return {Object} Alfred item\n     */\n    parse(project: Object): ?Object {\n        if (!project.paths) {\n            console.warn('Skipping project missing paths, possibly a template.');\n            return null;\n        }\n\n        let item = {\n            uid: Buffer.from(this._title(project) + this._subtitle(project), 'utf8').toString('base64'),\n            title: this._title(project),\n            subtitle: this._subtitle(project),\n            icon: {\n                path: this._icon(project)\n            },\n            arg: this._openArgument(project, atomApp),\n            valid: project.paths && project.paths.length > 0,\n            mods: {\n                alt: {\n                    valid: true,\n                    subtitle: 'Open project path(s) in terminal',\n                    arg: this._openArgument(project, terminalApp)\n                },\n                cmd: {\n                    valid: true,\n                    subtitle: 'Open in new window',\n                    arg: this._openArgument(project, atomApp, ['-n'])\n                },\n                ctrl: {\n                    valid: true,\n                    subtitle: 'Open in development mode',\n                    arg: this._openArgument(project, atomApp, ['-d'])\n                },\n                fn: {\n                    valid: true,\n                    subtitle: 'Append project path(s) to last open window',\n                    arg: this._openArgument(project, atomApp, ['-a'])\n                },\n                shift: {\n                    valid: true,\n                    subtitle: 'Open project path(s) in finder',\n                    arg: this._openArgument(project, 'Finder')\n                }\n            }\n        };\n\n        return item;\n    }\n\n    /**\n     * Parse a list of projects\n     *\n     * @param {Array.Object} projects List of Atom project definitions\n     *\n     * @return {Array.Object} Alfred items\n     */\n    parseAll(projects: Array<Object>): Array<Object> {\n        let result = [];\n\n        for (let i = 0; i < projects.length; i++) {\n            let project = this.parse(projects[i]);\n\n            if (project !== null && project !== undefined) {\n                result.push(project);\n            }\n        }\n\n        return result;\n    }\n\n    /**\n     * Find git repositories and turn it into a list of results\n     *\n     * @param {string} projectHome Directory to search for git repositories\n     * @param {boolean} prettifyTitle Prettify title\n     *\n     * @return {Array.Object} Alfred items\n     */\n    findGitRepositories(projectHome: string, prettifyTitle: boolean = true): Array<Object> {\n        let projects = [];\n\n        let dirs:Array<string> = glob.sync('*/.git', {\n            cwd: projectHome\n        });\n\n        dirs.forEach(dir => {\n            dir = dir.substring(0, dir.indexOf('/.git'));\n\n            let project = {\n                title: prettifyTitle ? changeCase.title(dir) : dir,\n                group: 'Git repository',\n                paths: [\n                    path.resolve(projectHome, dir)\n                ]\n            };\n\n            projects.push(project);\n        });\n\n        return this.parseAll(projects);\n    }\n}\n\nmodule.exports = new Project();\n"],"file":"project.js"}